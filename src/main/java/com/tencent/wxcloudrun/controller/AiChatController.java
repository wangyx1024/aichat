package com.tencent.wxcloudrun.controller;

import com.github.plexpt.chatgpt.Chatbot;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.collections4.MapUtils;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.PostConstruct;
import java.util.Map;

@RestController
@Slf4j
public class AiChatController {

    private Chatbot chatbot;

    @PostConstruct
    public void init() {
        if (chatbot == null) {
            chatbot = new Chatbot("eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..banLfX4hbpAYYvX3.jafm9LZh7fXle0rUh_J1813uQyPjB9kGML2pzXt_AkdTgCswLpduyRKpNYSM_tw_ErP2I-1i3mh4YTGfSgZN_hkcWIx9HdZxxPFuGiXWmQJYzoRmZjS1fNxfJnzh-MIp2-8BEOwc6sKplLvNOEWXfMIEO3uLa4oWAE8yQYONwuScUqqONJ7gCGw6ppHI1apo2MLptVG5a9VfHemwX91ulwZS8aC90A4Lf8qo_RGIU0Uu0Y0CCUFhvI4CgD_UNIeyrS27OhUszMsI9yLIv-Z9HHAcacuKPzxV04pywHn9q_JLKNMt3S6Ln83acsBYgF09oK1zCoapHpy-gQZk_kTKw3HmPaqHaTJAyE9JKYBWp4x1lVS-j3YR5Z1LcHbbraqxMBmrnCgSpj_XikfBys9TnZJYAtY6cnSJe_0sGYT_bB1RhGzNAdSV5yUx8cz19Y2AILENnCoZEhSI5g8-jiw0em415Dd_VfLwV2NmW6MS6B-qhmc2RwYWKBKSSQC6v4-SUw0h0CO5uF-qCsuGnkeRKP_8ISycpqRfCfqdsX6FKU-iTThPbv2_0UvO8bc4U5VYhg29cQ1WipLni9nIw660FmbHUYvvcLkcOgdhHVrBJMlLX_TD4cIXpWXM5FXhyOqZnHRNyAl7yPvyUl9_Zb2f9Zt2LHA3I475Z6rq4tmj15wi6RvR4osJslFCC3jKRBzdqavUD1u2ZQENv_8YghhMx8sqYMzw4E5Zhw04glTi5rww7xCuk4tWB57C7Ksp_X6Un7KjxfO3n05qh-oLUSWFBMk_QZDAqBnl5ss0ly0o00SwgQ5zDCc4JHmZPJCTm8PJ2LgLJqsswD3ikyVzoC1fXzq1_U7HLmwT46BQAsqA-OxXOThMJJcZJ9vun1GsqjQb3SOZWGSpbBzJR1O6FAqiT6-icFVhyylAhNmtkYngMGbYJj_8C3XdiaB3S-QguX-vfXuMuvqQVqb-vq4U2rR-1ik4HRdr1jQXOHG3QUlmRIdUdL_z4XF8TDh6XTmig7a9Owntws7lTL6heXj1IpeSiDvWAlx7DGHyhGFXuuigc1ZnXbsk0t6kWiYdwiaFctAjqrwKVpw8MlSzR-hKwitg6T8lZxY4kAlUtp4SeBbJUH9vcCbysQYC-wC8xkuXZ_v_f_43esfPEYEirLqB7HSxdRe_XJGsGZjKKW3xa2zEIqhxY_AuekEso6Sbs_2wqkDeuPPSyIJPssiwkuuqi0c2LH3-93wxasGjsasDc_39i5p9CnTonISIgSvp-Irj5_n4psgo0Sdj3qIT7zDoifTnHKlwYJhqLy0YuJvv_4r1ueo_j6IKrIeBM1i_kgSJgS86ejEfMf80ybs0bX6-EJJiJ6dwHfvQn-rhIQuyvFsEFtzvaCYCBIdQRB6aZwof6t2cuGiTJk_kzh0sFL-jKClUbHhBfsHsJr4W27YaR-9CIKhXfS3d2z_ubp9UKD4Ww_VfH9u0MoeZc5w0AvUKgG4cmerI_boTLPldyQyo-ZFPAxUz08QFd0n0umGWM8CgQkd00_sKDRGsPs5ah6W5Kaw_gkQtN46VaKB3HeJP1-rVnxL60Cw0DloObd5J0HwPMx_t3yOQ-0WYmy1oQJZJW1-4JrPS7jQhwywA4D77AbJyDvF3ekGlhpgbreKMxBVTwUE3A8VLox4xo22cz0SvGuEhFwJ_mgcV_pBEczdlVE55ZjaLpnK4ka_7iBbCBICydKVjKhnszD2IvAROg9mLKx7m5jyFrga0XPyx9qa7HFB2xrVwJX_0yPp4LnU-q_I74dnbHxzPGSMqQvayssFkn67OafoezHmHRRBP7VtlMxa1A5byJNSDTr6E9B3tZD_hiBPx81H01l_-f1AFODRSzGJoogHRd0_Nizs02iVFWonL7CcNNu3c7mfTrl5-FMxVAudhBwQcMkMdMmizNcprP-0QUb8ekitLczb3GjNJ0Tlw3yYL2Jqu4_r4pvGYZM-IbDIWuxo4LaOYHTCsd2j8Z0EA_pCOibdWqjIhhhs4LMY-rJfiW3qwA7PCCp1K0iSuWICfwRJ6UB_IMCVkm6IvxBDe-lYWie4HzzfdIv8fw6_vdbGs_GWlaCySkEXAww7jJ4ACFqUiiXp36N0IIcNitgqBa3yThfwnqN9I5v7vlFCuy6U0RR7i3wa7TRSAoKoC6akAl--pGGzMb1l8ogHmU4Yiy-Q6b0jeWiyJFvwUoNfrkqiHg5vAXj00NYHb8CNCLVwIa_jQV88UlVNf60RIp5OtM-qOhFDjQuDeWmzoXKX5spo0m5Hrt93yrN2wA_t31Y0gqBa6EMlANpnF5hmoaq7n1K7W0aTwy05MUiqD8HY9zn0ezGWRv-OeM589IjwAWmxZUQ-aSFlbAaSfGlT_PA.i86LDCFxGt4yVG728L1PyQ");
        }
    }

    @GetMapping("/api/aichat/chat")
    public String generate(@RequestParam String message) {
        Map<String, Object> chatResponse = chatbot.getChatResponse(message);
        log.info("requestMessage=" + message + ";chatResponse==" + chatResponse);
        String responseMessage = MapUtils.getString(chatResponse, "message");
        return responseMessage;
    }
}
